<h2 class="text-center mb-4 text-primary">Feed de Publicaciones</h2>

<div class="card shadow-sm mb-5">
    <div class="card-body">
        <h5 class="card-title">üì§ Nueva Publicaci√≥n</h5>
        <form method="post" action="/posts/" enctype="multipart/form-data">
            <input type="hidden" name="id_usuario" id="id_usuario_publicacion">
            <input type="hidden" name="carrera" id="carrera_publicacion">

            <div class="mb-3">
                <label for="titulo" class="form-label">T√≠tulo</label>
                <input type="text" class="form-control" id="titulo" name="titulo" placeholder="Escribe un t√≠tulo atractivo..." required>
            </div>
            <div class="mb-3">
                <label for="descripcion" class="form-label">Descripci√≥n</label>
                <textarea class="form-control" id="descripcion" name="descripcion" rows="3" placeholder="Comparte algo interesante..." required></textarea>
            </div>
            <div class="mb-3">
                <label for="archivo" class="form-label">Archivo (PDF, JPG, MP4)</label>
                <input type="file" class="form-control" id="archivo" name="archivo" accept=".pdf,.jpg,.jpeg,.mp4">
            </div>
            <button type="submit" class="btn btn-primary w-100">Publicar</button>
        </form>
    </div>
</div>

<script>
window.addEventListener("DOMContentLoaded", () => {
    document.getElementById("id_usuario_publicacion").value = localStorage.getItem("user_id");
    document.getElementById("carrera_publicacion").value = localStorage.getItem("carrera");
});
</script>

<!-- Publicaciones existentes -->
<div>
    {% for post in posts %}
    <div class="card mb-4 shadow-sm">
        <div class="card-body">
            <h5 class="card-title text-dark">{{ post.titulo }}</h5>
            <p class="card-text">{{ post.descripcion }}</p>

            {% if post.archivo_id %}
            <a href="/posts/archivo/{{ post.archivo_id }}" class="btn btn-sm btn-outline-secondary" target="_blank">
                üìé Ver archivo
            </a>
            {% endif %}

            <div class="mt-3 text-muted small">
                Publicado por <strong>{{ post.id_usuario }}</strong>
            </div>

            <div class="mt-3">
                <strong>Reacciones:</strong>
                <span>üëç {{ post.reacciones.like | default(0) }}</span>
                <span>‚ù§Ô∏è {{ post.reacciones.love | default(0) }}</span>
                <span>üî• {{ post.reacciones.fire | default(0) }}</span>
            </div>

            <hr>
            <div>
                <strong>Comentarios:</strong>
                {% for comentario in post.comentarios %}
                <p><strong>{{ comentario.usuario }}:</strong> {{ comentario.contenido }}</p>
                {% endfor %}

                <form method="post" action="/comments/">
                    <input type="hidden" name="id_publicacion" value="{{ post.id }}">
                    <input type="hidden" name="id_usuario" id="comentario_user_{{ post.id }}">
                    <div class="mb-2">
                        <textarea class="form-control" name="contenido" rows="2" placeholder="Escribe un comentario..." required></textarea>
                    </div>
                    <button type="submit" class="btn btn-sm btn-secondary">Comentar</button>
                </form>
            </div>
        </div>
    </div>
    {% endfor %}
</div>

<script>
// Tambi√©n rellenamos el ID de usuario para los formularios de comentario
window.addEventListener("DOMContentLoaded", () => {
    const userId = localStorage.getItem("user_id");
    document.querySelectorAll('input[id^="comentario_user_"]').forEach(input => {
        input.value = userId;
    });
});
</script>

<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
